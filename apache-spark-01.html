
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="author" content="Bruno G. Eilliar" />
        <meta name="keywords" content="spark,data-science,clustering" />
        <meta name="description" content="Install Apache Spark on Amazon EC2 instance" />


    <title>Apache Spark #01 - Bruno G. Eilliar</title>

        <link rel="stylesheet" href="/theme/css/bootstrap.min.css" type="text/css" />

    <link href="/theme/css/font-awesome.min.css" rel="stylesheet" />
    <link href="/theme/css/pygments/native.css" rel="stylesheet" />
    
    <link href="/theme/css/pelican-twitchy.min.css" rel="stylesheet" />

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <!-- Feeds -->
</head>
<body data-spy="scroll" data-target="#scrollspy">
    <div id="wrapper">
        <!-- Sidebar -->
        <div id="sidebar-wrapper-small" class="twitchy-background">
            <ul id="accordion-small" class="sidebar-nav sidebar-nav-small">
                <li>
        <a href="" title="Bruno G. Eilliar" class="collapsed">
            <span class="glyphicon glyphicon-home"></span>
        </a>
    </li>
                <li class="nav-divider"></li>
                <li>
        <a href="/archives.html" title="Recent Articles" class="collapsed">
            <span class="glyphicon glyphicon-th-list"></span>
        </a>
    </li>
                
                <li class="nav-divider"></li>
                <li>
                    <a data-toggle="collapse" data-parent="#accordion-small" href="#collapse-social-small" title="Social" class="collapsed">
                        <i class="fa fa-users padding-small"></i>
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-social-small" class="collapse ">
                    <li>
                        <a href="mailto:engbrunoeilliar@gmail.com" title="Email"><i class="fa fa-envelope-square fa-lg padding-small"></i></a>
                    </li>
                    <li>
                        <a href="https://github.com/Eilliar" title="GitHub"><i class="fa fa-github-square fa-lg padding-small"></i></a>
                    </li>
                    <li>
                        <a href="https://br.linkedin.com/in/bruno-eilliar-97933437" title="LinkedIn"><i class="fa fa-linkedin-square fa-lg padding-small"></i></a>
                    </li>
                </ul></li>
                <li class="nav-divider"></li>
                <li>
        <a href="#" title="Back to top" class="collapsed">
            <span class="fa fa-arrow-up"></span>
        </a>
    </li>
            </ul>
        </div>
        <div id="sidebar-wrapper" class="twitchy-background">
            <ul id="accordion" class="sidebar-nav">
                <li class="sidebar-brand">
                    <a href="/">
                            <span class="glyphicon glyphicon-home padding-small"></span>
                            Bruno G. Eilliar
                    </a>
                </li>
                    <li>
                        <a href="/archives.html">
                            <span class="glyphicon glyphicon-th-list padding-small"></span>
                            Recent Articles
                        </a>
                    </li>
                <li class="nav-divider"></li>
                <li>
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse-social">
                        <i class="fa fa-users padding-small"></i>
                        Contact
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-social" class="sidebar_submenu collapse ">
                    <li>
                        <a href="mailto:engbrunoeilliar@gmail.com" title="Email">
                            <i class="fa fa-envelope-square fa-lg padding-small"></i>
                            Email
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/Eilliar" title="GitHub">
                            <i class="fa fa-github-square fa-lg padding-small"></i>
                            GitHub
                        </a>
                    </li>
                    <li>
                        <a href="https://br.linkedin.com/in/bruno-eilliar-97933437" title="LinkedIn">
                            <i class="fa fa-linkedin-square fa-lg padding-small"></i>
                            LinkedIn
                        </a>
                    </li>
                </ul></li>
                
                <li class="nav-divider"></li>
                <li>
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse-pages">
                        <i class="fa fa-folder-open padding-small"></i>
                        Pages
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-pages" class="sidebar_submenu collapse ">
                </ul></li>
                
                <li class="nav-divider"></li>
                <li>
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse-categories">
                        <i class="fa fa-folder-open padding-small"></i>
                        Categories
                    </a>
                </li>
                <li class="panel anti-panel"><ul id="collapse-categories" class="sidebar_submenu collapse ">
                    <li >
                        <a href="/category/posts.html">
                            <i class="fa fa-folder-open padding-small"></i>
                            posts
                            <span class="badge pull-right categorybadge">1</span>
                        </a>
                    </li>
                    <li class="active">
                        <a href="/category/spark.html">
                            <i class="fa fa-folder-open padding-small"></i>
                            Spark
                            <span class="badge pull-right categorybadge">1</span>
                        </a>
                    </li>
                </ul></li>
                
            </ul>
        </div>
        <!-- /#sidebar-wrapper -->
        <!-- open/close sidebar -->
        <a href="#menu-toggle" class="btn btn-default" id="menu-toggle">
            <span id="right-arrow" class="glyphicon glyphicon-chevron-right"  title="expand sidebar"></span>
            <span id="left-arrow" class="glyphicon glyphicon-chevron-left" title="minimize sidebar"></span>
        </a>
       <!-- /open/close sidebar -->

        <!-- Page Content -->
        <div id="page-content-wrapper">
            <div class="container-fluid">
<section id="content">
    <article>
        <div class="row">
            <div class="col-lg-9">
                <header class="page-header">
                    <h1>
                        <a href="/apache-spark-01.html"
                           rel="bookmark"
                           title="Permalink to Apache Spark #01">
                            Apache Spark #01
                        </a>
                        <small>
<div class="post-info">
    <div class="publish-info-block">
        <small>
            <span class="published">
                <i class="fa fa-calendar padding-small"></i><time datetime="2016-11-12T14:00:00-02:00"> SÃ¡b 12 novembro 2016</time>
            </span>
            <span class="category">
                <i class="fa fa-folder-open padding-small"></i><a href="/category/spark.html">Spark</a>
            </span>
            <span class="tags">
                <i class="fa fa-tags padding-small"></i>
                <a href="/tag/spark.html">spark</a> /                 <a href="/tag/data-science.html">data-science</a> /                 <a href="/tag/clustering.html">clustering</a>            </span>
        </small>
    </div>
</div><!-- /.post-info -->                        </small>
                    </h1>
                </header>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-9">
                <div class="entry-content">
                    <p>At <a href="https://www.cargox.com.br">CargoX</a> we are starting to develop new techonologies and I'm really excited to be part of that. I previously had a rapid contact with Apache Spark (at an EDX course) but never used it on more serious way. Right now I'm exploring this framework and would like to share some of my knowledge with all of you interested on getting started with this tool. </p>
<p>This post is about how to get started with <a href="http://spark.apache.org/">Apache Spark</a> on Standalone Mode. I'll not tell you about how this tool is amazing and so on, rather I will just teach you how to start Spark on a single machine running Ubuntu. But if you want to know a little more about Spark and how it works, you can watch <a href="https://www.youtube.com/watch?v=MFDtWW9ckqo">How Apache Spark Works</a>.</p>
<h3>Amazon EC2</h3>
<p>Before we install Spark we need a server. I recommend <a href="https://aws.amazon.com/ec2/">Amazon EC2</a>, it provides quick configure and launch servers in a pay-as-you-go model. If it's your first time on Amazon EC2 you can make use of a 1 year free t2.micro Linux instance, wich is more than enough for our exploratory purposes. See more about that <a href="https://aws.amazon.com/free/">here</a>.</p>
<p>Make sure to launch and connect via ssh to your t2.micro instance, you can follow the steps described <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EC2_GetStarted.html">here</a>. If you don't have an Amazon account you will need to create one, and this is the down side: you will need a credit card to be able to continue. But for me is working fine, even though my credit card is not international. But relax, to use your free t2.micro instance you will not be charged at all, during a year. After that period you will be charged only if you use it. (Amazon is not paying me for this... sadly).</p>
<h3>Installing Spark</h3>
<p>Go to <a href="http://spark.apache.org/downloads.html">Apache Spark Download</a>, we need to get the link to download it into our EC2 instance. It's the 4 item on the image below. Right click on it and copy it into your clipboard.</p>
<p><img alt="SparkDownload" src="/images/SparkDownload.png" /></p>
<p>Now, on your EC2 instance (through ssh connection) type the following commands:</p>
<div class="highlight"><pre><span></span><span class="c1"># To Home Directory</span>
<span class="nb">cd</span> ~
<span class="c1"># Download Spark to home directory:</span>
wget http://d3kbcqa49mib13.cloudfront.net/spark-2.0.1-bin-hadoop2.7.tgz
<span class="c1"># Unpack Spark in /opt directory</span>
sudo tar zxvf spark-2.0.1-bin-hadoop2.7.tgz -C /opt
<span class="c1"># Create a symbolic link to make life easier</span>
sudo -ln -fs spark-2.0.1-bin-hadoop2.7 /opt/spark
</pre></div>


<p>Let's now set a <em>SPARK_HOME</em> environment variable so it takes effect every time we login into our EC2 instance. Insert the following lines into your <em>~/.bash_profile</em>, then save it:</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">SPARK_HOME</span><span class="o">=</span>/opt/spark
<span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$SPARK_HOME</span>/bin
<span class="nb">export</span> PATH
</pre></div>


<p>Reload the environment variables to take effect:</p>
<div class="highlight"><pre><span></span><span class="nb">source</span> ~/.bash_profile

<span class="c1"># Confirm spark-submit is in the PATH. This command will display a version number</span>
spark-submit --version
</pre></div>


<p>On your terminal you should see something like this:</p>
<p><img alt="SparkVersion" src="/images/sparkversion.png" /></p>
<h3>Testing Spark</h3>
<p>Let's run a simple example to see if everything is working as it should. Spark is written in Scala but it also comes with API for the following languages: Java (ugh!), Python (Oh Yeah!) and R (meh!). If you want to know more about each one, you can go to <a href="http://spark.apache.org/docs/latest/api.html">Spark API Documentation</a>.  </p>
<p>So, we will count the lines on the <em>README.md</em> file that comes with Spark. First, we can use the linux <em>wc</em> command to get the rigth answer:</p>
<div class="highlight"><pre><span></span><span class="x">wc -l </span><span class="p">$</span><span class="nv">SPARK_HOME</span><span class="x">/README.md</span>
</pre></div>


<p>Mine is showing 99 lines. Now let's do the same on the Spark Interactive Shell. The nice thing about using interactive shell is that it offers a quick way to get started with Spark jobs. I'll be using Python Interactive shell, because I am more familiar with Python language. You can start a shell in the language of your choice.</p>
<div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$SPARK_HOME</span>
<span class="nv">$SPARK_HOME</span>/bin/pyspark
</pre></div>


<p>Once the shell is started we see that a SparkSession is available as 'spark'. We will see more about that in the future. </p>
<p><img alt="PySpark" src="/images/pyspark01.png" /></p>
<p>Now we can run the following lines of code to also read the README.md file and count the number of lines.</p>
<div class="highlight"><pre><span></span><span class="c1"># Load README.md file into a Resilient Distributed Dataset (RDD).</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">textFile</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="s2">&quot;README.md&quot;</span><span class="p">)</span>
<span class="c1"># Check tye of textFile</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="n">textFile</span><span class="p">)</span>
<span class="c1"># Count the number of lines into the file.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">textFile</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="c1"># Exit interactive Shell</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">quit</span><span class="p">()</span>
</pre></div>


<p>We see that the count matches with our previous value! Congratulations, now you have Spark running on a EC2 instance. I will continue to explore Spark and will bring more interisting applications with this amazing tool.</p>
<p>See you on the next post. ;)</p>
                </div>
                <footer class="text-right">
                    <p>- Bruno G. Eilliar</p>
                </footer>
            </div>
        </div>
    </article>
</section>
<footer>
    <hr>
    <div class="row">
        <div class="col-lg-9 text-center">
            <p><small>
                Built by <a href="http://docs.getpelican.com/en/latest">Pelican</a> / <a href="https://github.com/ingwinlu/pelican-twitchy">pelican-twitchy</a>
                &middot;                    &copy; 2016 Bruno Godoi Eilliar
            </small></p>
        </div>
    </div>
</footer>            </div>
        </div>
        <!-- /#page-content-wrapper -->
    </div>
    <!-- /#wrapper -->
    <!-- jQuery Version 1.11.2 -->
    <script src="/theme/js/jquery-1.11.2.min.js"></script>
    <!-- Bootstrap Core JavaScript -->
    <script src="/theme/js/bootstrap.min.js"></script>
    <!-- twitchy Script -->
    <script src="/theme/js/pelican_twitchy.min.js"></script>

</body>
</html>